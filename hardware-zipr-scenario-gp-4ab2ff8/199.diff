--- libraries/DataFlash/DataFlash_File.cpp
+++ libraries/DataFlash/DataFlash_File.cpp
@@ -637,7 +637,9 @@
         free(fname);
         return 0;
     }
-    free(fname);
+    if (this->_write_fd == -1) {
+return false;}
+
     return st.st_size;
 }
 
